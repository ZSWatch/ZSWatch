(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[6019],{1909:function(e,t,s){var i,n;!function(r,a){"use strict";var o=4294967296,l=9007199254740992;(n="function"==typeof(i={encode:function(e){var t,s=new ArrayBuffer(256),i=new DataView(s),n=0;function r(e){for(var r=s.byteLength,a=n+e;r<a;)r<<=1;if(r!==s.byteLength){var o=i;s=new ArrayBuffer(r),i=new DataView(s);for(var l=n+3>>2,c=0;c<l;++c)i.setUint32(c<<2,o.getUint32(c<<2))}return t=e,i}function c(){n+=t}function d(e){c(r(1).setUint8(n,e))}function h(e){for(var t=r(e.length),s=0;s<e.length;++s)t.setUint8(n+s,e[s]);c()}function u(e,t){t<24?d(e<<5|t):t<256?(d(e<<5|24),d(t)):t<65536?(d(e<<5|25),function(e){c(r(2).setUint16(n,e))}(t)):t<4294967296?(d(e<<5|26),function(e){c(r(4).setUint32(n,e))}(t)):(d(e<<5|27),function(e){var t=e%o,s=(e-t)/o,i=r(8);i.setUint32(n,s),i.setUint32(n+4,t),c()}(t))}if(function e(t){var s;if(!1===t)return d(244);if(!0===t)return d(245);if(null===t)return d(246);if(t===a)return d(247);switch(typeof t){case"number":if(Math.floor(t)===t){if(0<=t&&t<=l)return u(0,t);if(-l<=t&&t<0)return u(1,-(t+1))}return d(251),function(e){c(r(8).setFloat64(n,e))}(t);case"string":var i=[];for(s=0;s<t.length;++s){var o=t.charCodeAt(s);o<128?i.push(o):o<2048?(i.push(192|o>>6),i.push(128|63&o)):o<55296?(i.push(224|o>>12),i.push(128|o>>6&63),i.push(128|63&o)):(o=(1023&o)<<10,o|=1023&t.charCodeAt(++s),o+=65536,i.push(240|o>>18),i.push(128|o>>12&63),i.push(128|o>>6&63),i.push(128|63&o))}return u(3,i.length),h(i);default:var f;if(Array.isArray(t))for(u(4,f=t.length),s=0;s<f;++s)e(t[s]);else if(t instanceof Uint8Array)u(2,t.length),h(t);else{var g=Object.keys(t);for(u(5,f=g.length),s=0;s<f;++s){var p=g[s];e(p),e(t[p])}}}}(e),"slice"in s)return s.slice(0,n);for(var f=new ArrayBuffer(n),g=new DataView(f),p=0;p<n;++p)g.setUint8(p,i.getUint8(p));return f},decode:function(e,t,s){var i=new DataView(e),n=0;function r(e,t){return n+=e,t}function l(t){return r(t,new Uint8Array(e,n,t))}function c(){return r(1,i.getUint8(n))}function d(){return r(2,i.getUint16(n))}function h(){return r(4,i.getUint32(n))}function u(){return 255===i.getUint8(n)&&(n+=1,!0)}function f(e){if(e<24)return e;if(24===e)return c();if(25===e)return d();if(26===e)return h();if(27===e)return h()*o+h();if(31===e)return-1;throw"Invalid length encoding"}function g(e){var t=c();if(255===t)return-1;var s=f(31&t);if(s<0||t>>5!==e)throw"Invalid indefinite length element";return s}function p(e,t){for(var s=0;s<t;++s){var i=c();128&i&&(i<224?(i=(31&i)<<6|63&c(),t-=1):i<240?(i=(15&i)<<12|(63&c())<<6|63&c(),t-=2):(i=(15&i)<<18|(63&c())<<12|(63&c())<<6|63&c(),t-=3)),i<65536?e.push(i):(i-=65536,e.push(55296|i>>10),e.push(56320|1023&i))}}"function"!=typeof t&&(t=function(e){return e}),"function"!=typeof s&&(s=function(){return a});var m=function e(){var o,h,m=c(),b=m>>5,_=31&m;if(7===b)switch(_){case 25:return function(){var e=new ArrayBuffer(4),t=new DataView(e),s=d(),i=32768&s,n=31744&s,r=1023&s;if(31744===n)n=261120;else if(0!==n)n+=114688;else if(0!==r)return(i?-1:1)*r*5.960464477539063e-8;return t.setUint32(0,i<<16|n<<13|r<<13),t.getFloat32(0)}();case 26:return r(4,i.getFloat32(n));case 27:return r(8,i.getFloat64(n))}if((h=f(_))<0&&(b<2||6<b))throw"Invalid length";switch(b){case 0:return h;case 1:return-1-h;case 2:if(h<0){for(var x=[],y=0;(h=g(b))>=0;)y+=h,x.push(l(h));var w=new Uint8Array(y),v=0;for(o=0;o<x.length;++o)w.set(x[o],v),v+=x[o].length;return w}return l(h);case 3:var j=[];if(h<0)for(;(h=g(b))>=0;)p(j,h);else p(j,h);return String.fromCharCode.apply(null,j);case 4:var I;if(h<0)for(I=[];!u();)I.push(e());else for(I=new Array(h),o=0;o<h;++o)I[o]=e();return I;case 5:var U={};for(o=0;o<h||h<0&&!u();++o){U[e()]=e()}return U;case 6:return t(e(),h);case 7:switch(h){case 20:return!1;case 21:return!0;case 22:return null;case 23:return a;default:return s(h)}}}();if(n!==e.byteLength)throw"Remaining bytes";return m}})?i.call(t,s,t,e):i)===a||(e.exports=n)}()},6336:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>b});var i=s(6393),n=s(6540),r=s(2362),a=s(1909),o=s.n(a);const l=class{constructor(e){void 0===e&&(e={}),this.SERVICE_UUID="8d53dc1d-1db7-4cd3-868b-8a527460aa84",this.CHARACTERISTIC_UUID="da2e7828-fbce-4e01-ae9e-261174997c48",this._mtu=244,this._netbuf_size=2450,this._device=null,this._service=null,this._characteristic=null,this._connectCallback=null,this._connectingCallback=null,this._disconnectCallback=null,this._messageCallback=null,this._imageUploadProgressCallback=null,this._uploadIsInProgress=!1,this._chunkTimeout=5e3,this._retryCount=0,this._buffer=new Uint8Array,this._logger=e.logger||{info:console.log,error:console.error},this._seq=0,this._userRequestedDisconnect=!1}async _requestDevice(e){console.log(e);const t={acceptAllDevices:!0,optionalServices:[6159,this.SERVICE_UUID]};return e&&(t.filters=e,t.acceptAllDevices=!1),navigator.bluetooth.requestDevice(t)}async connect(e){try{this._device=await this._requestDevice(e),this._logger.info(`Connecting to device ${this.name}...`),this._device.addEventListener("gattserverdisconnected",(async e=>{this._logger.info(e),this._userRequestedDisconnect?this._disconnected():(this._logger.info("Trying to reconnect"),this._connect(1e3))})),this._connect(0)}catch(t){return this._logger.error(t),void await this._disconnected()}}_connect(){setTimeout((async()=>{try{this._connectingCallback&&this._connectingCallback();const e=await this._device.gatt.connect();this._logger.info("Server connected."),this._service=await e.getPrimaryService(this.SERVICE_UUID),this._logger.info("Service connected."),this._characteristic=await this._service.getCharacteristic(this.CHARACTERISTIC_UUID),this._logger.info("Characteristic connected."),this._characteristic.addEventListener("characteristicvaluechanged",this._notification.bind(this)),this._logger.info("Notifications enabled."),await this._characteristic.startNotifications(),this._logger.info("Notifications started."),this._mtu=e.mtu||this._mtu,this._logger.info(`MTU size: ${this._mtu} bytes`),await this._connected(),this._logger.info("Connected."),this._uploadIsInProgress&&this._uploadNext()}catch(e){this._logger.error(e),await this._disconnected()}}),1e3)}disconnect(){return this._userRequestedDisconnect=!0,this._device.gatt.disconnect()}onConnecting(e){return this._connectingCallback=e,this}onConnect(e){return this._connectCallback=e,this}onDisconnect(e){return this._disconnectCallback=e,this}onMessage(e){return this._messageCallback=e,this}onImageUploadProgress(e){return this._imageUploadProgressCallback=e,this}onFsUploadProgress(e){return this._fsUploadProgressCallback=e,this}onImageUploadFinished(e){return this._imageUploadFinishedCallback=e,this}onFsUploadFinished(e){return this._fsUploadFinishedCallback=e,this}async _connected(){this._connectCallback&&this._connectCallback()}async _disconnected(){this._logger.info("Disconnected."),this._disconnectCallback&&this._disconnectCallback(),this._device=null,this._service=null,this._characteristic=null,this._uploadIsInProgress=!1,this._userRequestedDisconnect=!1}get name(){return this._device&&this._device.name}sleep(e){return new Promise((t=>setTimeout(t,e)))}splitBuffer(e,t){void 0===t&&(t=20);const s=[],i=new Uint8Array(e);for(let n=0;n<i.length;n+=t)s.push(i.slice(n,n+t));return s}async writeLargeBuffer(e,t,s,i){void 0===s&&(s=20),void 0===i&&(i=1);const n=this.splitBuffer(e,s);for(const a of n){try{t.writeValueWithoutResponse(a)}catch(r){console.warn("Write failed:",r),await this.sleep(2*i);continue}await this.sleep(i)}}async _sendMessage(e,t,s,i){let n=[];void 0!==i&&(n=[...new Uint8Array(o().encode(i))]);const r=255&n.length,a=[e,0,n.length>>8,r,t>>8,255&t,this._seq,s,...n];this.writeLargeBuffer(Uint8Array.from(a),this._characteristic,this._mtu,5),this._seq=(this._seq+1)%256}_notification(e){const t=new Uint8Array(e.target.value.buffer||e.target.value);this._buffer=new Uint8Array([...this._buffer,...t]);const s=256*this._buffer[2]+this._buffer[3];this._buffer.length<s+8||(this._processMessage(this._buffer.slice(0,s+8)),this._buffer=this._buffer.slice(s+8))}_processMessage(e){const[t,s,i,n,r,a,l,c]=e,d=o().decode(e.slice(8).buffer),h=256*i+n,u=256*r+a;if(1===u&&1===c&&(0===d.rc||void 0===d.rc)&&d.off)return this._uploadTimeout&&clearTimeout(this._uploadTimeout),this._uploadOffset=d.off,this._uploadIsInProgress&&this._uploadNext(),void(this._retryCount=0);if(8===u&&0===c){if((0===d.rc||void 0===d.rc)&&d.off)return this._uploadTimeout&&(clearTimeout(this._uploadTimeout),console.log("Upload timeout cleared")),this._uploadOffset=d.off,this._uploadIsInProgress&&this._uploadNextFileSystem(),void(this._retryCount=0);0!==d.rc&&(this._logger.error("Error uploading file:",d.rc),this._uploadTimeout&&(clearTimeout(this._uploadTimeout),console.log("Upload timeout cleared")),this._retryCount<3?(this._logger.info("Retrying upload..."),this._retryCount++,this._uploadNextFileSystem()):(this._logger.error("Upload failed after 3 retries"),this._uploadIsInProgress&&(this._fsUploadFinishedCallback(!1),this._uploadIsInProgress=!1)))}this._messageCallback&&this._messageCallback({op:t,group:u,id:c,data:d,length:h})}cmdReset(){return this._sendMessage(2,0,5)}smpEcho(e){return this._sendMessage(2,0,0,{d:e})}cmdImageState(){return this._sendMessage(0,1,0)}cmdImageErase(e){return void 0===e&&(e=1),this._sendMessage(2,1,5)}cmdImageTest(e){return this._sendMessage(2,1,0,{hash:e,confirm:!1})}cmdImageConfirm(e){return this._sendMessage(2,1,0,{hash:e,confirm:!0})}_hash(e){return crypto.subtle.digest("SHA-256",e)}async _uploadNext(){if(this._uploadOffset>=this._uploadImage.byteLength||!this._uploadIsInProgress)return this._uploadIsInProgress=!1,void this._imageUploadFinishedCallback();this._uploadTimeout&&clearTimeout(this._uploadTimeout),this._uploadTimeout=setTimeout((()=>{this._logger.info("Upload chunk timeout, retry"),this._uploadNext()}),this._chunkTimeout);const e={data:new Uint8Array,off:this._uploadOffset,image:this._uploadImageNumber};0===this._uploadOffset&&(e.len=this._uploadImage.byteLength,e.sha=new Uint8Array(await this._hash(this._uploadImage))),this._imageUploadProgressCallback({percentage:Math.floor(this._uploadOffset/this._uploadImage.byteLength*100)});const t=this._mtu-o().encode(e).byteLength-8;e.data=new Uint8Array(this._uploadImage.slice(this._uploadOffset,this._uploadOffset+t));try{await this._sendMessage(2,1,1,e)}catch(s){return this._logger.error("Error sending upload message:",s),void clearTimeout(this._uploadTimeout)}}async cmdUpload(e,t,s){void 0===t&&(t=0),void 0===s&&(s=0),this._uploadIsInProgress?this._logger.error("Upload is already in progress."):(this._logger.info(`Starting upload of image ${t}...`),this._uploadIsInProgress=!0,this._logger.info(`Image size: ${e.byteLength} bytes`),this._logger.info(`MTU size: ${this._mtu} bytes`),this._uploadOffset=0,this._retryCount=0,this._uploadImage=e,this._uploadImageNumber=t,this._uploadSlot=s,this._uploadNext())}async imageInfo(e){const t={},s=new Uint8Array(e);if(s.length<32)throw new Error("Invalid image (too short file)");if(61!==s[0]||184!==s[1]||243!==s[2]||150!==s[3])throw new Error("Invalid image (wrong magic bytes)");if(0!==s[4]||0!==s[5]||0!==s[6]||0!==s[7])throw new Error("Invalid image (wrong load address)");const i=s[8]+256*s[9];if(0!==s[10]||0!==s[11])throw new Error("Invalid image (wrong protected TLV area size)");const n=s[12]+256*s[13]+65536*s[14]+s[15]*2**24;if(t.imageSize=n,s.length<n+i)throw new Error("Invalid image (wrong image size)");if(0!==s[16]||0!==s[17]||0!==s[18]||0!==s[19])throw new Error("Invalid image (wrong flags)");const r=`${s[20]}.${s[21]}.${s[22]+256*s[23]}`;return t.version=r,t.hash=[...new Uint8Array(await this._hash(e.slice(0,n+i)))].map((e=>e.toString(16).padStart(2,"0"))).join(""),t}async cmdUploadFileSystemImage(e,t){this._uploadIsInProgress?this._logger.error("Upload is already in progress."):(this._logger.info(`Starting upload of image to ${t}... of ${e.byteLength} bytes`),this._uploadIsInProgress=!0,this._logger.info(`Image size: ${e.byteLength} bytes`),this._logger.info(`MTU size: ${this._mtu} bytes`),this._uploadOffset=0,this._retryCount=0,this._uploadImage=e,this._uploadName=t,this._uploadNextFileSystem())}async _uploadNextFileSystem(){if(this._uploadOffset>=this._uploadImage.byteLength||!this._uploadIsInProgress)return this._uploadIsInProgress=!1,console.log("Upload finished"),void this._fsUploadFinishedCallback(!0);this._uploadTimeout&&clearTimeout(this._uploadTimeout),this._uploadTimeout=setTimeout((()=>{this._logger.info("Upload chunk timeout, retry"),this._uploadNextFileSystem()}),this._chunkTimeout);const e={data:new Uint8Array,off:this._uploadOffset,name:this._uploadName};0===this._uploadOffset&&(e.len=this._uploadImage.byteLength),this._fsUploadProgressCallback({percentage:Math.floor(this._uploadOffset/this._uploadImage.byteLength*100)});let t=this._netbuf_size-o().encode(e).byteLength-20;t-=t%4,console.log("File offset",this._uploadOffset),e.data=new Uint8Array(this._uploadImage.slice(this._uploadOffset,this._uploadOffset+t));try{this._sendMessage(2,8,0,e)}catch(s){return this._logger.error("Error sending upload message:",s),void clearTimeout(this._uploadTimeout)}}};var c=s(1710),d=s.n(c),h=s(4848);const u={0:"App Internal",1:"Net Core",2:"App External (XIP)"},f={"app.internal.bin":0,"ipc_radio.bin":1,"app.external.bin":2},g=e=>Array.from(e).map((e=>e.toString(16).padStart(2,"0"))).join(""),p="ZSWatch",m="ZSWatch",b=()=>{const[e,t]=(0,n.useState)("ZSWatch"),[s,a]=(0,n.useState)("connected"),[o,c]=(0,n.useState)(null),[b,_]=(0,n.useState)(null),[x,y]=(0,n.useState)(!1),[w,v]=(0,n.useState)([]),[j,I]=(0,n.useState)([]),[U,C]=(0,n.useState)("Select image files (.bin or .zip)"),[k,N]=(0,n.useState)(!1),[S,A]=(0,n.useState)(!1),[T,F]=(0,n.useState)(null),[P,E]=(0,n.useState)("Select a filesystem file"),R=(0,n.useRef)(new l),D=R.current,z=(0,n.useRef)(null),B=(0,n.useRef)(null),$=(0,n.useRef)(null),O=(0,n.useRef)(null),L=(0,n.useRef)(null),M=(0,n.useRef)(0),[q,W]=(0,n.useState)([]);(0,n.useEffect)((()=>{const e=navigator?.bluetooth?.getAvailability()||!1;N(e),D.onConnecting((()=>{a("connecting")})),D.onConnect((()=>{t(D.name),a("connected"),D.cmdImageState()})),D.onDisconnect((()=>{a("initial")})),D.onImageUploadProgress((e=>{let{percentage:t}=e;C(`Uploading... ${t}%`),c(t);const s=Date.now(),i=(s-O.current)/1e3,n=t-M.current;if(n>0&&L.current){const e=n/100*L.current;_((e/1024/i).toFixed(2)),O.current=s,M.current=t}})),D.onImageUploadFinished((()=>{C("Upload complete"),_(null),console.log("File upload finished",j);const e=j.find((e=>!e.isUploaded&&!e.isUploading));e?X(e):(console.log("All files uploaded"),D.cmdImageState(),Y()),I((e=>e.map((e=>e.isUploading?{...e,isUploaded:!0,isUploading:!1}:e))))})),D.onFsUploadFinished((e=>{E(e?"Upload complete":"Upload failed"),F(null)})),D.onMessage((e=>{let{group:t,id:s,data:i}=e;switch(t){case 0:switch(s){case 0:alert(i.r);break;case 2:console.table(i.tasks);break;case 3:console.log(i)}break;case 1:if(0===s){if(v(i.images||[]),!i.images)return;j.forEach((e=>{const t=i.images.find((t=>t.image===e.imageNumber&&g(t.hash)===e.hash));t&&I((s=>s.map((s=>s===e?{...s,isUploaded:!1,mcuMgrImageStatus:`Active: ${t.active}, Pending: ${t.pending}, Slot: ${t.slot}`}:s))))}))}break;default:console.log("Unknown group")}}))}),[D,j]);const H=e=>{const s=e.target.value;t(s),localStorage.setItem("deviceName",s)},V=async e=>{A(!0);const t=await async function(e){void 0===e&&(e=5);let t=[];try{const s=await fetch(`https://api.github.com/repos/${p}/${m}/actions/runs`,{}),i=await s.json();if(!i.workflow_runs||0===i.workflow_runs.length)return void console.log("No workflow runs found.");console.log("Found",i,i.workflow_runs.length,"workflow runs.");const n=i.workflow_runs.filter((e=>"success"===e.conclusion&&"gh-pages"!==e.head_branch)).slice(0,e);console.log(`Fetching artifacts from the latest ${e} workflow runs...`);for(const e of n){console.log(`Processing workflow run: ${e.id} (${e.name})`,e);const s=await fetch(`https://api.github.com/repos/${p}/${m}/actions/runs/${e.id}/artifacts`,{}),i=await s.json();if(!i.artifacts||0===i.artifacts.length){console.log(`No artifacts found for workflow run: ${e.id}`);continue}const n={branch:e.head_branch,user:e.actor.login,runId:e.id,artifacts:i.artifacts.filter((e=>e.name.includes("@4")||e.name.includes("@5")))};t.push(n)}}catch(s){console.error("Error fetching artifacts:",s)}return t}(e);console.log("Fetched firmwares:",t),t&&W(t),A(!1)},Z=e=>{const t=e.target.files[0];if(!t)return void C("No file selected");const s=new FileReader;s.onload=async()=>{"application/zip"===t.type?(await(async(e,t)=>{const s=new(d());try{const e=await s.loadAsync(t.result),i=await Promise.all(Object.keys(e.files).filter((e=>e.endsWith(".bin"))).map((async t=>{const s=await e.files[t].async("arraybuffer"),i=f[t];if(null==i)return alert(`Invalid file: ${t}. Please use a valid binary file name.`),null;const n=await D.imageInfo(s);return{version:n.version,hash:n.hash,fileSize:s.byteLength,imageNumber:i,fileData:s,name:t,isUploaded:!1,isUploading:!1,isSetPending:!1,mcuMgrImageStatus:""}})));I((e=>[...e.filter((e=>!i.some((t=>t&&t.imageNumber===e.imageNumber)))),...i.filter((e=>null!==e))])),C("Ready to upload")}catch(i){console.error("Error reading zip file:",i),C("Invalid zip file")}})(0,s),C("Using zip file")):await(async(e,t)=>{let s=f[e.name];if(null==s&&(s=parseInt(prompt("Enter the image number:","0"),10),isNaN(s)||s<0))return alert("Invalid image number. Please enter a non-negative integer."),void C("Ready to upload");try{const i=await D.imageInfo(t.result);I((n=>[...n.filter((e=>e.imageNumber!==s)),{version:i.version,hash:i.hash,fileSize:t.result.byteLength,imageNumber:s,fileData:t.result,name:e.name,isUploaded:!1,isUploading:!1,isSetPending:!1,mcuMgrImageStatus:""}])),C("Ready to upload")}catch(i){console.error("Error reading file:",i),C("Invalid image file")}})(t,s),z.current.value=null,D.cmdImageState()},s.readAsArrayBuffer(t)},Y=async()=>{if(window.confirm("Do you want to confirm the images and restart the device? After confirming, you need to restart the device to apply the changes."))for(const e of j){const t=Uint8Array.from(e.hash.match(/.{1,2}/g).map((e=>parseInt(e,16))));await D.cmdImageTest(t)}},X=async e=>{if(e){y(!0),c(0),_(null),C("Uploading..."),L.current=e.fileSize,$.current=Date.now(),O.current=Date.now(),M.current=0;try{await D.cmdUpload(e.fileData,e.imageNumber),y(!1),I((t=>t.map((t=>t===e?{...t,isUploading:!0}:t))))}catch(t){C("Upload failed"),y(!1)}}else C("Ready to upload")},G=async()=>{if(j.length<=0)y(!1);else if(j[0].fileData){const e=j.find((e=>!e.isUploaded));e?X(e):(C("All files uploaded"),y(!1),Y())}},J=async e=>{const t=e.target.files[0];if(!t)return void E("No file selected");console.log("Selected file:",t);const s=new FileReader;s.onload=async e=>{E("Uploading..."),F(0);const t=R.current;t.onFsUploadProgress((e=>{let{percentage:t}=e;F(t)}));try{await t.cmdUploadFileSystemImage(s.result,"/S/full_fs"),E("Upload started")}catch(i){console.error("Filesystem upload failed:",i),E("Upload failed"),F(null)}B.current.value=null},s.readAsArrayBuffer(t)},K=async()=>{const t=e?[{namePrefix:e}]:null;await D.connect(t)},Q=async()=>{await D.disconnect()},ee=()=>(0,h.jsxs)("div",{children:[(0,h.jsx)("h2",{children:"Upload Filesystem"}),(0,h.jsxs)(r.A,{type:"tip",icon:"\ud83d\udca1",title:"How to...",children:["Select the ",(0,h.jsx)("strong",{children:"lvgl_resources_raw.bin"})," file found in previously downloaded zip.",(0,h.jsx)("br",{})]}),(0,h.jsx)("input",{type:"file",ref:B,onChange:J}),(0,h.jsxs)("p",{children:["Status: ",P]}),null!==T&&(0,h.jsxs)("p",{children:["Progress: ",T,"%"]})]});return(0,h.jsx)(i.A,{children:(0,h.jsx)("div",{children:(0,h.jsxs)("div",{className:"container",children:[(0,h.jsx)("h1",{children:"FW Update over BLE"}),(()=>{switch(s){case"initial":return(0,h.jsxs)("div",{className:"content",children:[(0,h.jsx)(r.A,{type:k?"tip":"warning",icon:"\ud83d\udca1",children:k?"Bluetooth is available in your browser.":"This tool is compatible with desktops (or laptops) with the\n                  latest Chrome, Opera and Edge browsers, and working Bluetooth connection (most\n                  laptops have them these days). You can also try it from Chrome on Android, or Bluefy\n                  on iOS/iPadOS."}),(0,h.jsx)("div",{id:"connect-block",children:(0,h.jsxs)("div",{className:"form-group form-inline",children:[(0,h.jsx)("div",{className:"col-auto",children:(0,h.jsx)("input",{style:{padding:"5px",fontSize:"1em",marginBottom:"10px"},id:"device-name-input",type:"text",className:"form-control",placeholder:"Device name (optional)",value:e,onChange:H})}),(0,h.jsx)("div",{className:"col-auto",children:(0,h.jsxs)("button",{id:"button-connect",type:"submit",className:"btn btn-primary",onClick:K,children:[(0,h.jsx)("i",{className:"bi-bluetooth"})," Connect"]})})]})})]});case"connecting":return(0,h.jsx)("div",{className:"content",children:(0,h.jsx)("div",{className:"alert alert-primary",role:"alert",children:"Connecting..."})});case"connected":return(0,h.jsx)("div",{className:"content",children:(0,h.jsxs)("div",{className:"container",children:[t(),(0,h.jsx)("hr",{}),(0,h.jsx)("h3",{children:"Prebuilt firmwares"}),l(),(0,h.jsx)("h3",{children:"Image Upload"}),(0,h.jsxs)(r.A,{type:"tip",icon:"\ud83d\udca1",title:"How to...",children:["Upload the ",(0,h.jsx)("strong",{children:"dfu_application.zip"})," previosuly downloaded.",(0,h.jsx)("br",{}),"Then press ",(0,h.jsx)("strong",{children:"Upload"})," button to upload the firmware.",(0,h.jsx)("br",{})]}),i(G),(0,h.jsxs)("details",{children:[(0,h.jsx)("summary",{children:"Troubleshooting"}),(0,h.jsxs)(r.A,{type:"info",icon:"",title:"",children:["If upload hangs, or doesn't start then try again after resetting the watch. If the watch FW is not working this way of uploading will not work as it relies on Bluetooth and application working. To fix this you need to use the ",(0,h.jsx)("strong",{children:"mcumgr over USB"})," method."]})]}),ee()]})});case"connected_advanced":return(0,h.jsx)("div",{className:"content",children:(0,h.jsxs)("div",{className:"container",children:[(0,h.jsxs)(r.A,{type:"tip",icon:"\ud83d\udca1",title:"How to...",children:["Upload the all binary files or .zip containing all binary files",(0,h.jsx)("br",{})]}),t(),(0,h.jsx)("hr",{}),(0,h.jsx)("h3",{children:"Images"}),(0,h.jsx)("div",{id:"image-list",style:{display:"flex",flexWrap:"wrap",gap:"10px",marginBottom:"10px"},children:w.map(((e,t)=>(0,h.jsxs)("div",{className:"image "+(e.active?"active":"standby"),children:[(0,h.jsxs)("h2",{children:[e.active?"active":"standby"," ",u[e.image]," Slot"," ",e.slot]}),(0,h.jsxs)("table",{children:[(0,h.jsxs)("tr",{children:[(0,h.jsx)("th",{children:"Image index (for actions)"}),(0,h.jsx)("td",{children:t})]}),(0,h.jsxs)("tr",{children:[(0,h.jsx)("th",{children:"Image number"}),(0,h.jsx)("td",{children:e.image})]}),(0,h.jsxs)("tr",{children:[(0,h.jsx)("th",{children:"slot"}),(0,h.jsx)("td",{children:e.slot})]}),(0,h.jsxs)("tr",{children:[(0,h.jsx)("th",{children:"Version"}),(0,h.jsxs)("td",{children:["v",e.version]})]}),(0,h.jsxs)("tr",{children:[(0,h.jsx)("th",{children:"Bootable"}),(0,h.jsx)("td",{children:e.bootable?"true":"false"})]}),(0,h.jsxs)("tr",{children:[(0,h.jsx)("th",{children:"Confirmed"}),(0,h.jsx)("td",{children:e.confirmed?"true":"false"})]}),(0,h.jsxs)("tr",{children:[(0,h.jsx)("th",{children:"Pending"}),(0,h.jsx)("td",{children:e.pending?"true":"false"})]}),(0,h.jsxs)("tr",{children:[(0,h.jsx)("th",{children:"Hash"}),(0,h.jsx)("td",{children:(0,h.jsx)("div",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"150px",cursor:"pointer"},title:g(e.hash),onClick:()=>{navigator.clipboard.writeText(g(e.hash)),alert("Hash copied to clipboard!")},children:Array.from(e.hash).map((e=>e.toString(16).padStart(2,"0"))).join("")})})]})]})]},t)))}),(0,h.jsxs)("div",{style:{display:"flex",gap:"10px",marginBottom:"10px"},children:[(0,h.jsxs)("button",{id:"button-image-state",type:"submit",className:"btn btn-info",onClick:()=>D.cmdImageState(),children:[(0,h.jsx)("i",{className:"bi-arrow-down-circle"})," Refresh"]}),(0,h.jsxs)("button",{type:"submit",className:"btn btn-warning",onClick:()=>D.cmdImageErase(),children:[(0,h.jsx)("i",{className:"bi-eraser-fill"})," Erase"]}),(0,h.jsxs)("button",{type:"submit",className:"btn btn-success",onClick:()=>{const e=parseInt(prompt("Enter the image index:","0"),10);isNaN(e)||!1!==w[e]?.pending||D.cmdImageTest(w[e].hash)},children:[(0,h.jsx)("i",{className:"bi-question-square"})," Test"]}),(0,h.jsxs)("button",{id:"button-confirm",type:"submit",className:"btn btn-success",onClick:()=>{const e=parseInt(prompt("Enter the image index:","0"),10);isNaN(e)||!1!==w[e]?.confirmed||D.cmdImageConfirm(w[e].hash)},children:[(0,h.jsx)("i",{className:"bi-check2-square"})," Confirm"]})]}),(0,h.jsx)("hr",{}),(0,h.jsx)("h3",{children:"Image Upload"}),i(G),ee()]})});default:return null}function t(){return(0,h.jsxs)("div",{style:{display:"flex",gap:"10px",marginBottom:"10px"},children:[(0,h.jsxs)("button",{className:"btn btn-primary",onClick:()=>{const e=prompt("Enter a text message to send","Hello World!");D.smpEcho(e)},children:[(0,h.jsx)("i",{className:"bi-soundwave"})," Echo"]}),(0,h.jsxs)("button",{className:"btn btn-danger",onClick:Q,children:[(0,h.jsx)("i",{className:"bi-x-square"})," Disconnect"]}),(0,h.jsxs)("button",{className:"btn btn-warning",onClick:()=>D.cmdReset(),children:[(0,h.jsx)("i",{className:"bi-arrow-clockwise"})," Reset"]}),(0,h.jsxs)("button",{className:"btn btn-info",onClick:()=>a("connected_advanced"),children:[(0,h.jsx)("i",{className:"bi-arrow-clockwise"})," Use advanzed mode"]})]})}function i(e){return(0,h.jsxs)("div",{children:[(0,h.jsx)("div",{className:"form-group",style:{marginBottom:"10px"},children:(0,h.jsx)("input",{type:"file",className:"form-control",id:"file-image",onChange:Z,disabled:x,ref:z})}),(0,h.jsxs)("div",{className:"image",style:{padding:"10px",border:"1px solid #ccc",borderRadius:"5px"},children:[(0,h.jsxs)("div",{className:"form-group",style:{marginBottom:"10px"},children:[(0,h.jsx)("div",{id:"file-status",children:U}),(0,h.jsx)("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap"},children:j&&j.map(((e,t)=>(0,h.jsx)("table",{id:"file-info",style:{backgroundColor:"#1B1B1D",border:"1px solid #ccc",borderRadius:"5px",padding:"10px"},children:(0,h.jsxs)("tbody",{children:[(0,h.jsxs)("tr",{children:[(0,h.jsx)("th",{children:"Name"}),(0,h.jsx)("td",{children:e.name})]}),(0,h.jsxs)("tr",{children:[(0,h.jsx)("th",{children:"Image number"}),(0,h.jsx)("td",{children:e.imageNumber})]}),(0,h.jsxs)("tr",{children:[(0,h.jsx)("th",{children:"Version"}),(0,h.jsx)("td",{children:e.version})]}),(0,h.jsxs)("tr",{children:[(0,h.jsx)("th",{children:"Hash"}),(0,h.jsx)("td",{children:(0,h.jsx)("div",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"150px",cursor:"pointer"},title:e.hash,onClick:()=>{navigator.clipboard.writeText(e.hash),alert("Hash copied to clipboard!")},children:e.hash})})]}),(0,h.jsxs)("tr",{children:[(0,h.jsx)("th",{children:"File Size"}),(0,h.jsxs)("td",{children:[e.fileSize," bytes"]})]}),(0,h.jsxs)("tr",{children:[(0,h.jsx)("th",{children:"Upload Status"}),(0,h.jsxs)("td",{children:[e.isUploading&&(0,h.jsxs)("div",{style:{width:"100%",borderRadius:"5px"},children:[(0,h.jsx)("div",{style:{width:`${o}%`,backgroundColor:"#4caf50",height:"10px",borderRadius:"5px"}}),(0,h.jsxs)("span",{style:{fontSize:"16px"},children:[o,"% Speed: ",b," kbps"]})]}),e.isUploaded&&(0,h.jsxs)("div",{style:{width:"100%",borderRadius:"5px"},children:[(0,h.jsx)("div",{style:{width:"100%",backgroundColor:"#4caf50",height:"10px",borderRadius:"5px"}}),(0,h.jsx)("span",{style:{fontSize:"16px"},children:e.mcuMgrImageStatus})]})]})]})]})},t)))})]}),(0,h.jsxs)("button",{className:"btn btn-secondary",disabled:0===j.length||x,onClick:e,children:[(0,h.jsx)("i",{className:"bi-upload"})," Upload"]}),(0,h.jsxs)("button",{className:"btn btn-danger",onClick:()=>D.cmdImageErase(),children:[(0,h.jsx)("i",{className:"bi-upload"})," Erase files"]}),(0,h.jsxs)("button",{className:"btn btn-primary",onClick:()=>Y(),children:[(0,h.jsx)("i",{className:"bi-upload"})," Confirm files"]})]})]})}function n(e){let{children:t,color:s}=e;return(0,h.jsx)("span",{style:{backgroundColor:s,borderRadius:"2px",color:"#fff",padding:"0.2rem"},children:t})}function l(){return(0,h.jsxs)("div",{children:[(0,h.jsxs)("details",{children:[(0,h.jsx)("summary",{children:"Help"}),(0,h.jsxs)(r.A,{type:"note",icon:"",title:"",children:["If you don't have a firmware, you can fetch one from here.",(0,h.jsx)("br",{}),"You will see the last builds in CI. Pick the build you want, for example last build on the ",(0,h.jsx)("strong",{children:"main branch."}),(0,h.jsx)("br",{}),"Then choose the artifact corresponding to your watch version (4 or 5) and click on it to download the firmware.",(0,h.jsx)("br",{})]})]}),(0,h.jsxs)(r.A,{type:"info",icon:"",title:"",children:["Once downloaded you need to unzip it and upload the ",(0,h.jsx)("strong",{children:"dfu_application.zip"})," ","file below.",(0,h.jsx)("br",{})]}),(0,h.jsx)("button",{className:"btn btn-success",onClick:()=>V(6),style:{marginBottom:"10px"},children:"Fetch Prebuilt Firmwares"}),S?(0,h.jsx)("p",{children:"Loading..."}):0===q.length?(0,h.jsx)("p",{children:"No prebuilt firmwares fetched."}):(0,h.jsx)("div",{children:q.map(((e,t)=>(0,h.jsxs)("details",{style:{marginBottom:"10px"},children:[(0,h.jsxs)("summary",{children:["Branch ",(0,h.jsx)(n,{color:"#1877F2",children:e.branch})," by user"," ",(0,h.jsx)(n,{color:"green",children:e.user})]}),(0,h.jsxs)("div",{style:{padding:"10px",border:"1px solid #ccc",borderRadius:"5px"},children:[(0,h.jsx)("p",{children:(0,h.jsx)("strong",{children:"Artifacts:"})}),(0,h.jsx)("ul",{children:e.artifacts.map(((t,s)=>(0,h.jsx)("li",{children:(0,h.jsx)("button",{className:"btn btn-primary",onClick:()=>async function(e,t){try{C("Downloading firmware...");const s=`https://github.com/ZSWatch/ZSWatch/actions/runs/${e}/artifacts/${t}`;console.log("URL",s),C("Firmware download started. Please check your browser's downloads."),window.location.href=s}catch(s){console.error("Error downloading or flashing firmware:",s),C("Failed to download firmware.")}}(e.runId,t.id),style:{width:"50%",marginBottom:"10px"},children:t.name})},s)))})]})]},t)))})]})}})()]})})})}}}]);