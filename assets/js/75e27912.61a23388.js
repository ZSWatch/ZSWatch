"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[3395],{1037:e=>{e.exports=JSON.parse('{"permalink":"/blog/progress-hw-xip-usb-power","source":"@site/blog/2025-10-10-progress-hw-xip-usb-power/index.md","title":"Power conusumption, HW update & Production test","description":"As usual, a lot has landed since our last update, but much of it hasn\u2019t been very visual, so the updates here have been quiet. On hardware, we focused on revision two of the Devkit and the heart\u2011rate test PCB. On software, we optimized power (especially reducing XIP power draw), improved firmware updates over BLE and USB (WebSerial), and added a couple of apps. We also built a dedicated production test application to verify hardware functions during manufacturing. Below is a quick tour, plus a short technical deep\u2011dive on how XIP works on ZSWatch and why it matters for battery life.","date":"2025-10-10T00:00:00.000Z","tags":[{"inline":false,"label":"ZSWatch","permalink":"/blog/tags/zswatch","description":"ZSWatch core"},{"inline":false,"label":"ZSWatch Hardware","permalink":"/blog/tags/zswatch_hardware","description":"ZSWatch hardware core"},{"inline":false,"label":"ZSWatch Software","permalink":"/blog/tags/zswatch_software","description":"ZSWatch software core"}],"readingTime":6.1,"hasTruncateMarker":true,"authors":[{"name":"Jakob Krantz","title":"Senior Software Engineer and ZSWatch Creator and Maintainer","url":"https://jakobkrantz.se","page":{"permalink":"/blog/authors/jakkra"},"socials":{"github":"https://github.com/jakkra","linkedin":"https://www.linkedin.com/in/jakob-krantz-ba9a97127/"},"imageURL":"https://github.com/jakkra.png","key":"jakkra"}],"frontMatter":{"slug":"progress-hw-xip-usb-power","title":"Power conusumption, HW update & Production test","authors":["jakkra"],"tags":["zswatch","zswatch_hardware","zswatch_software"]},"unlisted":false,"nextItem":{"title":"Development Kit Prototype","permalink":"/blog/progress-devkit-prototype"}}')},1725:(e,t,a)=>{a.d(t,{A:()=>i});var n=a(6540);function s(){return s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)({}).hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},s.apply(null,arguments)}const i=e=>{let{title:t,titleId:a,...i}=e;return n.createElement("svg",s({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 3.9 996.9 279.4","aria-labelledby":a},i),t?n.createElement("title",{id:a},t):null,n.createElement("path",{fillRule:"evenodd",d:"M522.6 197.4c187.1-5.5 315.9 6.3 474.3 26.1l-6.6 4.5c-132.3-9.4-216.7-24-364.6-19.8-237.5 6.2-436.5 37.9-625.7 75.1l5.6-26.5q63.8-12.1 128.1-21.8 64.6-9.8 129.1-17.1 64.6-7.6 129.6-12.5 64.9-5.2 130.2-8",style:{fill:"#e46622"}}),n.createElement("path",{fillRule:"evenodd",d:"m322.6 40.7-21.9 20.8Q277.8 37.9 250 37.9q-5.6 0-11.1 1-5.2 1.1-10.4 3.2-5.2 2-9.7 5.2-4.9 2.7-8.7 6.9-3.8 3.8-7 8.4-3.1 4.5-5.2 9.7-2.1 4.9-3.1 10.4-1 5.2-1 10.8 0 3.8.3 7.6.3 3.9 1.4 7.3.7 3.9 2.1 7.3 1.4 3.5 3.1 7 1.7 3.1 4.2 5.9 2 3.1 4.8 5.6 2.5 2.4 5.2 4.5 3.2 2.1 6.3 3.8 3.5 1.7 6.9 3.1 3.5 1.4 7.3 2.5 3.5.7 7.3 1.4 3.8.3 7.6.3 3.2 0 6.3-.3 3.1-.4 6.6-1.1 3.1-.3 6.2-1.4 3.2-1 5.9-2.4 3.5-1.8 7-3.5 3.1-2.1 6.2-4.5 3.2-2.1 6.3-4.9 2.8-2.4 5.5-5.2l21.2 21.9q-3.8 3.8-7.6 7.3-4.2 3.5-8.7 6.6-4.2 3.1-8.7 5.9-4.8 2.5-9.3 4.9-4.6 1.7-9.1 3.1-4.8 1.4-9.4 2.1-4.8 1-9.3 1.4-4.9.3-9.7.3-38.2 0-62.9-24.3-24.6-24-24.6-62.2 0-5.6.6-11.5.7-5.5 2.1-11.1t3.5-10.8q2.4-5.2 5.2-10.1 2.8-4.8 6.3-9.3 3.4-4.2 7.6-8.4 3.8-3.8 8.7-6.9 4.5-3.5 9.4-5.9 5.2-2.8 10.4-5.2 5.5-2.1 11.1-3.5 5.5-1.4 11.4-2.1t11.8-.7q4.9 0 10.1.3 4.9.7 10.1 1.8 4.8 1 9.7 2.4 4.9 1.8 9.4 3.8 4.8 2.1 9.4 4.9 4.1 2.4 8.3 5.6 4.2 3.1 8 6.6 3.8 3.4 7.3 7.3M19.4 183.9V6.3h57.3q33 0 42.7 2.7 3.9 1.1 7.3 2.5 3.9 1.7 7 3.8 3.5 2.4 6.2 5.2 2.8 2.8 5.2 5.9 2.5 3.5 4.6 7.7 2 4.1 3.4 8.7 1.4 4.5 2.1 9 .4 4.5.4 9 0 3.5-.4 7.3-.3 3.5-1 7-.7 3.4-1.8 6.6-1.4 3.5-2.7 6.6-1.4 2.8-3.2 5.2-1.7 2.1-3.4 4.5l-4.2 4.2q-2.1 1.7-4.5 3.5-2.1 1.7-4.2 2.7-2.4 1.4-4.5 2.5-2.4 1-4.9 1.7-2.4 1.1-4.8 1.4-4.5 1-9.4 1.4-4.5.7-9.4 1-4.5.4-9 .4H55.6v66.7zm702-180-45.8 180H626L597.1 72.7l-27.7 111.2h-50l-45.5-180h46.8l25 120.6L576 3.9h44.7l28.9 120.9 26-120.9zM980.1 48l-68.4 186h-45.5l20.5-53.2L837 48h44.5l28.4 85.5L936.7 48zM796.4 169.7q-4.2 3.4-7.6 6.6-1.1.7-2.5 1.4-1 1-2 1.7-1.1.7-2.5 1.4-1 .7-2.4 1-3.1 1.8-6.3 2.8-3.1 1.4-6.2 2.1-3.5.7-7 1h-6.6q-4.1 0-8.3-.7t-8-2.4q-3.8-1.4-7.3-3.8-3.4-2.4-6.6-5.2-2.7-3.2-5.2-6.6-2.1-3.5-3.8-7.3-1.4-4.2-2.1-8.4-.7-4.1-.7-8.3 0-3.1.4-6.3.3-3.1 1-6.2.7-3.2 2.1-6.3 1-2.8 2.8-5.5 1.4-2.5 3.5-4.6 1.7-2 4.1-4.1 2.1-1.8 4.5-3.5 2.5-1.4 5.2-2.4 3.2-1.8 6.6-2.8 3.2-1.4 6.6-2.5 3.5-.7 7.3-1.3l7-1.4q15.9-2.1 34.4-3.5v-.7q.3-2.4-.4-4.5-.3-2.5-1.4-4.5-1.4-2.1-2.8-3.9-1.7-1.4-3.8-2.7-2.8-1.1-5.9-2.1l-6.2-1.4q-3.2-.4-6.3-.7h-6.6q-2.1 0-4.1.3-2.5 0-4.6.4-2 .3-4.5 1-2.1.4-4.1 1.1-2.5.7-5.3 1.4-2.4.6-4.8 1.7-2.4.7-4.9 1.7-2.4 1.1-4.8 2.1h-3.5v-33q6.2-1.7 20.5-4.2 3.5-.7 6.9-1 3.5-.4 7-.7 3.8-.4 7.3-.7h6.9q35.1 0 51.4 11.8 16 11.5 16 35.5v92.4h-42v-14.6zm0-20.8v-28.5q-10.8 1-17.4 2-1.7 0-3.5.4-1.4.3-3.1.7-1.7.3-3.1 1-1.8.4-3.5 1.1-1 .3-2.4.7-1.1.7-2.1 1.4-1.4.7-2.1 1.7-1 1-2.1 1.7-.7 1.4-1.4 2.5-.3 1.4-1 2.7-.4 1.4-.4 2.8-.3 1.4-.3 2.5.3 9.7 5.2 13.2 1.7 1 3.8 1.7 1.8.7 3.5 1.4 2.1.3 4.2.3 1.7.4 3.8 0h2.8q1.7-.3 3.1-.7l2.8-.6q1.3-.4 2.7-1.1l2.8-1.4q1.4-.7 2.8-1.7 1-.7 2.4-1.8 1.4-1 2.5-2m-325-19.9c0 8.7 1.3 17.4-2.1 24q-1.4 2.5-2.8 4.9-1.4 2.1-3.1 4.2-1.8 2.1-3.9 4.1-1.7 1.8-4.1 3.5-2.5 2.1-4.9 3.8-2.8 1.8-5.5 3.2-2.8 1.4-5.9 2.4-2.8 1.4-5.9 2.1-3.9 1-7.7 1.7t-7.6 1.1q-3.8.3-7.7.7H330V4.3h71.2q3.8.3 7.7.3 3.8.4 7.6.7 3.8.4 7.3.7 2.8.4 5.2 1.1 2.4.3 4.9 1.3 2.4.7 4.5 1.8 2.4 1 4.8 2.1 2.1 1 4.2 2.8 2.1 1.3 3.8 3.1 2.1 1.7 3.5 3.8 1.7 2.1 2.8 4.2 1.4 2.4 2 4.8 1.1 2.5 1.8 4.9t.7 5.2q.3 2.5.3 5.2 0 3.2-.3 6.3-.4 3.1-1.4 5.9-.7 3.1-2.1 5.9-1 2.8-2.8 5.6-1.7 2.4-3.4 4.5-2.1 2.4-4.6 4.2-2 2-4.8 3.4-2.5 1.8-5.2 2.8V86q3.8.6 7.3 2 3.8 1.1 6.9 2.8 3.5 2.1 6.6 4.2 3.1 2.4 5.9 5.2c6.6 7.3 6.9 16.7 7 28.8m-54.9-73.3q0-1.4-.4-2.4 0-1.1-.3-2.5-.4-1-.7-2-.3-1.1-1-2.1-.4-1.1-1.1-2.1-.7-1.1-1.7-2.1-1.1-.7-2.1-1.4t-2.1-1q-1-.7-2.4-1.1-1.4-.3-2.8-.7-1.4-.3-2.4-.3-1.4 0-2.8-.4h-21.5v38.3h5.9c7.6 0 13.2 0 16.3-.4q1 0 2.4-.3 1.1 0 2.5-.4 1-.3 2.4-.7 1-.3 2.1-1 1.4-.4 2.4-1.1 1-.6 2.1-1.7 1-1 1.7-2.1.7-1 1.4-2.1.4-1.3.7-2.4.7-1.4.7-2.8.3-1 .3-2.4.4-1.4.4-2.8m11.1 73.3q.3-1.7 0-3.4 0-1.8-.7-3.5-.3-1.7-1-3.1-.7-1.8-1.8-3.2-.7-1-2.1-2.4-1-1-2.4-1.7-1-1.1-2.4-1.8-1.8-.7-3.1-1-1.4-.7-2.8-1.1-1.4-.3-2.8-.3-1.4-.3-2.8-.3-1.4-.4-3.1-.4h-27.4V152h2.4q17.7 0 24.3-.4 1.7 0 3.5-.3 1.7 0 3.5-.7 1.7-.3 3.4-.7 1.8-.7 3.5-1.4l2.8-1.4q1.4-.7 2.4-1.7 1-1.1 2.1-2.1 1-1.4 1.7-2.8.7-1 1.4-2.8.4-1.4.7-2.7.4-1.4.7-2.8zM54.7 37.3v50.4h19.4q21.6 0 28.5-2.8 1.7-.7 3.5-1.4 1.4-1 2.8-2.1 1.3-1 2.7-2.4 1.1-1.4 2.1-2.8 1.1-1.7 2.1-3.1.7-1.7 1-3.5.7-1.7.7-3.8.4-1.7.4-3.5 0-2.1-.4-4.5-.3-2.1-1-4.2t-1.7-3.8q-1.1-1.7-2.5-3.5-1.4-1.7-3.1-2.8-1.7-1.3-3.5-2.4-1.7-1-3.8-1.7t-4.2-1.1q-3.1-.3-6.2-.7-3.5 0-6.6-.3H72z",style:{fill:"#19882f"}}))}},2282:(e,t,a)=>{a.d(t,{A:()=>n});const n=a.p+"assets/images/website_usb_shell-e815bcbafac52569b6548ace51ca2c83.png"},2487:(e,t,a)=>{a.d(t,{A:()=>i});const n={signup:"signup_Jd1d",center:"center_lsS9",signupTitle:"signupTitle_Ta4P",emailInput:"emailInput_uoO2",subscribeBtn:"subscribeBtn_r9gI",blogReminder:"blogReminder_Sf3u"};var s=a(4848);function i(){return(0,s.jsx)("form",{method:"post",action:"https://zswatch.pikapod.net/subscription/form",className:n.signup,children:(0,s.jsxs)("div",{className:n.center,children:[(0,s.jsx)("div",{className:n.signupTitle,children:"Sign up for updates here"}),(0,s.jsx)("input",{type:"hidden",name:"nonce"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("input",{type:"email",name:"email",required:!0,placeholder:"Enter your email",className:n.emailInput}),(0,s.jsx)("input",{type:"submit",value:"Subscribe",className:n.subscribeBtn})]}),(0,s.jsx)("a",{href:"/blog",className:n.blogReminder,children:"Read the blog for latest info"}),(0,s.jsxs)("p",{hidden:!0,children:[(0,s.jsx)("input",{id:"2cca0",type:"checkbox",name:"l",defaultChecked:!0,value:"2cca0c50-ef0d-4339-b695-9e559f4a4359"}),(0,s.jsx)("label",{htmlFor:"2cca0",children:"ZSWatch Test List"}),(0,s.jsx)("br",{})]})]})})}},3046:(e,t,a)=>{a.d(t,{A:()=>n});const n=a.p+"assets/images/hr_v2_dk-6dd37889027a3847c22ecfe484eb48fa.png"},5028:(e,t,a)=>{a.d(t,{A:()=>n});const n=a.p+"assets/images/dk-1-2-render-8fb8ffa0dca1acc6c226f8a5fa3d0976.png"},6846:(e,t,a)=>{a.d(t,{A:()=>n});const n=a.p+"assets/images/website-cba005ccd208eebb7a790644b4adcd40.png"},8453:(e,t,a)=>{a.d(t,{R:()=>r,x:()=>o});var n=a(6540);const s={},i=n.createContext(s);function r(e){const t=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),n.createElement(i.Provider,{value:t},e.children)}},9715:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>m,contentTitle:()=>u,default:()=>b,frontMatter:()=>p,metadata:()=>n,toc:()=>f});var n=a(1037),s=a(4848),i=a(8453),r=a(2487),o=a(2282),l=a(6846),d=a(5028),h=a(3046),c=a(1725);const p={slug:"progress-hw-xip-usb-power",title:"Power conusumption, HW update & Production test",authors:["jakkra"],tags:["zswatch","zswatch_hardware","zswatch_software"]},u=void 0,m={authorsImageUrls:[void 0]},f=[{value:"DevKit v2 ordered (likely final version)",id:"devkit-v2-ordered-likely-final-version",level:3},{value:"Heart Rate board v2",id:"heart-rate-board-v2",level:3},{value:"XIP management and App UI state",id:"xip-management-and-app-ui-state",level:3},{value:"New Applications",id:"new-applications",level:3},{value:"Firmware updates over USB and visual overhaul",id:"firmware-updates-over-usb-and-visual-overhaul",level:3},{value:"Testability and power consumption",id:"testability-and-power-consumption",level:3},{value:"Production test build",id:"production-test-build",level:3},{value:"Watch housing update",id:"watch-housing-update",level:3},{value:"How XIP works on ZSWatch",id:"how-xip-works-on-zswatch",level:3},{value:"What\u2019s next",id:"whats-next",level:3}];function w(e){const t={a:"a",code:"code",h3:"h3",hr:"hr",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.p,{children:"As usual, a lot has landed since our last update, but much of it hasn\u2019t been very visual, so the updates here have been quiet. On hardware, we focused on revision two of the Devkit and the heart\u2011rate test PCB. On software, we optimized power (especially reducing XIP power draw), improved firmware updates over BLE and USB (WebSerial), and added a couple of apps. We also built a dedicated production test application to verify hardware functions during manufacturing. Below is a quick tour, plus a short technical deep\u2011dive on how XIP works on ZSWatch and why it matters for battery life."}),"\n",(0,s.jsx)(t.p,{children:"Let\u2019s dive into the details..."}),"\n",(0,s.jsx)(t.h3,{id:"devkit-v2-ordered-likely-final-version",children:"DevKit v2 ordered (likely final version)"}),"\n",(0,s.jsxs)(t.p,{children:["Last week we ordered what we believe is the final iteration of the ZSWatch Devkit (#2). We expect to receive it in about three weeks. As a trial for fulfillment, we plan to sell a limited quantity (at least initially) through ",(0,s.jsx)(t.a,{href:"https://www.elecrow.com",children:"https://www.elecrow.com"}),". We\u2019ll set up a shop there shortly. Make sure to sign up on the email list to not miss it!"]}),"\n",(0,s.jsx)("a",{href:d.A,target:"_blank",rel:"noopener noreferrer",children:(0,s.jsx)("img",{src:d.A,alt:"ZSWatch Devkit v1.2 render"})}),"\n",(0,s.jsx)(t.h3,{id:"heart-rate-board-v2",children:"Heart Rate board v2"}),"\n",(0,s.jsxs)(t.p,{children:["We also received version 2 of the heart\u2011rate test board, and it\u2019s working well. Compared to the v1 prototype from the earlier post (",(0,s.jsx)(t.a,{href:"/blog/progress-hr-fota",children:"Health PCB and Firmware Update"}),"), v2 includes bug fixes and a simplified optical front\u2011end and an extra photodiode:"]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"https://look.ams-osram.com/m/1a73f8d425cfcc40/original/SFH-7016.pdf",children:"Single LED module: OSRAM SFH 7016 (Red, Green, IR)"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"https://www.vishay.com/docs/80381/vemd8082.pdf",children:"Two photodiodes: Vishay VEMD8082"})}),"\n"]}),"\n",(0,s.jsx)("a",{href:h.A,target:"_blank",rel:"noopener noreferrer",children:(0,s.jsx)("img",{src:h.A,alt:"Heart\u2011Rate test board v2 on Devkit"})}),"\n",(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:16,margin:"0.25rem 0"},children:[(0,s.jsx)("a",{href:"https://www.pcbway.com/",target:"_blank",rel:"noopener noreferrer",style:{display:"inline-block",lineHeight:0},children:(0,s.jsx)(c.A,{style:{width:220,display:"block"}})}),(0,s.jsx)("div",{children:(0,s.jsx)(t.p,{children:"A big thanks to PCBWay for sponsoring manufacturing and assembly of our Heart\u2011Rate test PCB. That board uses via\u2011in\u2011pad, which makes fabrication more expensive. As always boards turned out great!"})})]}),"\n",(0,s.jsx)(t.h3,{id:"xip-management-and-app-ui-state",children:"XIP management and App UI state"}),"\n",(0,s.jsx)(t.p,{children:"We introduced an XIP manager and refined app state handling to safely disable XIP when the screen is off. This reduces baseline current consumption while ensuring apps and UI code don\u2019t crash when XIP is unavailable. Changes included:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"Keep app UI code in external flash, but keep app logic in internal flash so it can run while XIP is off."}),"\n",(0,s.jsx)(t.li,{children:"Add an app \u201cvisible/hidden\u201d state so UI updates don\u2019t run when XIP is disabled."}),"\n",(0,s.jsxs)(t.li,{children:["Careful walkthrough of what can live in external flash and what can\u2019t:","\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"Since we disable XIP when the screen is off, background code can\u2019t live in external flash anymore."}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"mcumgr"})," and USB live in XIP as they\u2019re only needed during updates. We explicitly enable them when performing updates in the ",(0,s.jsx)(t.a,{href:"https://github.com/ZSWatch/ZSWatch/blob/main/app/src/applications/update/update_app.c",children:"update app"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["For apps where the UI code is placed in QSPI flash with XIP, apps now need to guard like ",(0,s.jsx)(t.a,{href:"https://github.com/ZSWatch/ZSWatch/blob/e3052acf96fc31c813b4050af3b9a3d32d527b26/app/src/applications/stopwatch/stopwatch_app.c#L158",children:"this"}),":"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-c",children:"static void update_elapsed_time(void)\n{\n  if (stopwatch_data.state == STOPWATCH_STATE_RUNNING) {\n      uint64_t current_time = k_uptime_get();\n      stopwatch_data.elapsed_ms = (uint32_t)(current_time - stopwatch_data.start_time_ms);\n      \n      // Only update UI if XIP is enabled and UI is visible\n      if (app.current_state == ZSW_APP_STATE_UI_VISIBLE) {\n          stopwatch_ui_update_time(stopwatch_data.elapsed_ms);\n      }\n  }\n}\n"})}),"\n",(0,s.jsx)(t.h3,{id:"new-applications",children:"New Applications"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"FFT Spectrum visualizer with an emulated mic driver for the Linux/native build (handy for quick dev and testing)."}),"\n",(0,s.jsx)("video",{controls:!0,src:"https://github.com/user-attachments/assets/73f3b879-9343-4f80-ae69-938d120bc3fd",style:{width:"100%",maxHeight:"420px"}}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["Calculator app based on ",(0,s.jsx)(t.a,{href:"https://github.com/zephyrproject-rtos/zephyr/tree/main/samples/subsys/smf/smf_calculator",children:"Zephyr\u2019s SMF sample"}),"."]}),"\n",(0,s.jsx)("a",{href:"https://github.com/user-attachments/assets/841fbd2e-b997-4f68-b037-094cb0d60fca",target:"_blank",rel:"noopener noreferrer",children:(0,s.jsx)("img",{src:"https://github.com/user-attachments/assets/841fbd2e-b997-4f68-b037-094cb0d60fca",alt:"Calculator app on ZSWatch",style:{maxWidth:"320px",width:"100%"}})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(t.h3,{id:"firmware-updates-over-usb-and-visual-overhaul",children:"Firmware updates over USB and visual overhaul"}),"\n",(0,s.jsx)(t.p,{children:"We now support firmware updates over USB (in addition to BLE) using the browser\u2019s WebSerial API. This means you can also recover a watch that\u2019s stuck or has broken firmware by entering MCUBoot and performing a serial recovery directly from the website. The firmware update page also got a nice visual overhaul."}),"\n",(0,s.jsx)("a",{href:l.A,target:"_blank",rel:"noopener noreferrer",children:(0,s.jsx)("img",{src:l.A,alt:"ZSWatch website showing USB firmware update"})}),"\n",(0,s.jsx)(t.h3,{id:"testability-and-power-consumption",children:"Testability and power consumption"}),"\n",(0,s.jsx)(t.p,{children:"To keep power consumption low while still allowing automated tests on the same firmware, USB stays enabled for ~20s after boot so CI can connect and run firmware\u2011update tests reliably."}),"\n",(0,s.jsx)(t.p,{children:"We also enabled shell command support over BLE and USB, so the watch can be managed via the website Shell Console. Added shell commands to some random functions in ZSWatch, not very useful, but fun to play around with."}),"\n",(0,s.jsx)("a",{href:o.A,target:"_blank",rel:"noopener noreferrer",children:(0,s.jsx)("img",{src:o.A,alt:"Shell Console showing large shell output"})}),"\n",(0,s.jsx)(t.h3,{id:"production-test-build",children:"Production test build"}),"\n",(0,s.jsxs)(t.p,{children:["We now have a dedicated ",(0,s.jsx)(t.a,{href:"https://github.com/ZSWatch/ZSWatch/tree/main/production_test",children:"production test firmware"})," that reuses much of the main firmware. This app is required for verifying hardware functions during production and will be used by Elecrow when assembling DKs (and likely future watches) to confirm that all components work correctly."]}),"\n",(0,s.jsx)("video",{controls:!0,src:"https://github.com/user-attachments/assets/92a09a1a-dd70-44a3-abb9-1259be6760ec",style:{width:"100%",maxHeight:"420px"}}),"\n",(0,s.jsx)(t.h3,{id:"watch-housing-update",children:"Watch housing update"}),"\n",(0,s.jsx)(t.p,{children:"Simon, a mechanical engineer, has joined the project to help redesign the watch housing. This will give a much more streamlined and robust case, improving both aesthetics and durability. Nice!"}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsx)(t.h3,{id:"how-xip-works-on-zswatch",children:"How XIP works on ZSWatch"}),"\n",(0,s.jsx)(t.p,{children:"Execute\u2011in\u2011Place (XIP) lets the MCU run code directly from external flash over the QSPI interface. This gives us a lot more flash space for features, but it comes with two important considerations:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"Power: Keeping QSPI and its cache active adds to idle current around 3\u20135 mA, which is a lot for a watch."}),"\n",(0,s.jsx)(t.li,{children:"Safety: Parts of the code (e.g., some of LVGL, mcumgr/USB, etc.) reside in XIP. This code must not be called while XIP is disabled or it will crash."}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"Some of the things we do in ZSWatch to manage this:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"Some LVGL components are placed in external flash. We keep the most used parts and drawing code in internal flash since XIP is slower."}),"\n",(0,s.jsx)(t.li,{children:"App UI code is placed in the XIP area to save internal flash. App logic stays in internal flash so apps can continue running when the screen is off and XIP is disabled."}),"\n",(0,s.jsx)(t.li,{children:"XIP manager: A small manager arbitrates XIP enable/disable and provides a simple API so code that needs XIP can request it when needed. The API is ref\u2011counted and when the count hits 0, XIP is disabled, and vice versa."}),"\n",(0,s.jsx)(t.li,{children:"App visibility state: Apps are notified when their UI is visible/hidden so they don\u2019t call into LVGL (or other XIP code paths) when XIP is off."}),"\n",(0,s.jsxs)(t.li,{children:["On\u2011demand features: ",(0,s.jsx)(t.code,{children:"mcumgr"})," and USB live in the XIP area and are only enabled for updates."]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"Result: Idle current drops from ~5 mA to ~500 \xb5A with the display off. When you open an app or start an update, XIP is enabled as needed and then turned off again when we return to an idle screen\u2011off state or when a firmware update finishes. Going forward we\u2019ll have to be more careful with what lives in XIP and only things that aren\u2019t needed while the screen is off."}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsx)(t.h3,{id:"whats-next",children:"What\u2019s next"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"Continue power profiling, there\u2019s more to do."}),"\n",(0,s.jsx)(t.li,{children:"Validate the Dev Kit when received."}),"\n",(0,s.jsx)(t.li,{children:"Work has started on a completely reworked case for the upcoming ZSWatch."}),"\n"]}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)(t.p,{children:"Want to stay in the loop? Subscribe below for updates!"}),"\n",(0,s.jsx)(r.A,{}),"\n",(0,s.jsx)(t.hr,{})]})}function b(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(w,{...e})}):w(e)}}}]);