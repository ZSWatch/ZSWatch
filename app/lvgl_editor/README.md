# LVGL Editor Integration

This directory contains LVGL Editor generated UI components for ZSWatch applications.

## Structure

```
lvgl_editor/
├── components/              # UI components
│   └── music_app/          # Example: Music control component
│       ├── music_app.xml   # Component definition (edit this)
│       ├── music_app_gen.c # Generated code (DON'T edit)
│       └── music_app_gen.h # Generated header (DON'T edit)
├── images/                 # PNG images for Editor preview
├── globals.xml             # Global subjects, images, styles
├── lvgl_editor_gen.c       # Generated globals (DON'T edit)
├── lvgl_editor_gen.h       # Generated header (DON'T edit)
├── lvgl_editor.c           # Custom init wrapper (safe to edit)
├── lvgl_editor.h           # Custom header (safe to edit)
├── lvgl_compat.h           # LVGL API compatibility layer added for ZSWatch
└── CMakeLists.txt          # Build configuration
```

## Key Concepts

### Subjects (Reactive Data Binding)
Subjects are **global reactive variables** that automatically update the UI when changed.

**Example:**
```c
// In your app code
lv_subject_copy_string(&music_track_name, "Song Title");  // Label updates automatically!
lv_subject_set_int(&music_progress, 75);                   // Progress arc updates automatically!
```

No need to manually find and update UI widgets - subjects handle everything.

## Creating a New UI Component or Application

### Step 1: Define Subjects in globals.xml

Edit `globals.xml` to add your app's data:

```xml
<subjects>
    <string name="my_app_title" value="Default Title" />
    <int name="my_app_value" value="0" help="0-100" />
    <int name="my_app_state" value="0" help="0:off 1:on" />
</subjects>
```

**Subject types:**
- `<string>` - Text data
- `<int>` - Integer values (can also represent state flags)
- `<float>` - Floating point values

### Step 2: Add Images (Optional)

1. Copy PNG images for your app to `lvgl_editor/images/`:

2. Define in `globals.xml`:
```xml
<images>
    <data name="my_icon" src_path="images/my_icon.png" color_format="rgb565a8"/>
</images>
```

### Step 3: Create Component XML

Create `components/my_app/my_app.xml`:

```xml
<component>
    <previews>
        <preview width="240" height="240" style_bg_color="0x000000" />
    </previews>

    <api>
        <!-- No parameters needed - use global subjects instead -->
    </api>

    <styles>
        <style name="style_root" width="100%" height="100%" bg_opa="0" />
        <style name="style_title" text_align="center" text_font="montserrat_24" />
    </styles>

    <view>
        <remove_style_all />
        <style name="style_root" />

        <!-- Title label bound to subject -->
        <lv_label align="top_mid" y="20" bind_text="my_app_title">
            <style name="style_title" />
        </lv_label>

        <!-- Button with callback -->
        <lv_button align="bottom_mid" y="-20" clickable="true">
            <lv_label text="Toggle" />
            <event_cb callback="my_app_on_button_clicked" trigger="clicked" />
        </lv_button>
    </view>
</component>
```

### Step 4: Generate Code

1. Open **LVGL Editor** application
2. Load project: `File → Open Project → lvgl_editor`
3. Edit your component in the visual XML editor
4. Click **"Generate Code"**
5. Generated files appear in `lvgl_editor/`

### Step 5: Use in Your Application

Create `src/applications/my_app/my_app.c`:

```c
#include "lvgl_editor_gen.h"        // For subjects
#include "my_app_gen.h"              // For my_app_create()
#include "managers/zsw_app_manager.h"

// Declare subjects (defined in lvgl_editor_gen.c)
extern lv_subject_t my_app_title;
extern lv_subject_t my_app_value;
extern lv_subject_t my_app_state;

static lv_obj_t *ui_root;

// Event callback (must match XML event_cb name)
void my_app_on_button_clicked(lv_event_t *e)
{
    int state = lv_subject_get_int(&my_app_state);
    lv_subject_set_int(&my_app_state, !state);
}

static void my_app_start(lv_obj_t *root, lv_group_t *group)
{
    // Create the UI component generated by lvgl_editor
    ui_root = my_app_create(root);

    // Initialize data
    lv_subject_copy_string(&my_app_title, "My Application");
    lv_subject_set_int(&my_app_value, 50);
    lv_subject_set_int(&my_app_state, 0);
}

static void my_app_stop(void)
{
    lv_obj_del(ui_root);
}

// Register application
static application_t app = {
    .name = "My App",
    .start_func = my_app_start,
    .stop_func = my_app_stop
};

static int my_app_init(void)
{
    zsw_app_manager_add_application(&app);
    return 0;
}

SYS_INIT(my_app_init, APPLICATION, CONFIG_APPLICATION_INIT_PRIORITY);
```

### Step 6: Update Subjects from Your Code

```c
// Update title
lv_subject_copy_string(&my_app_title, "New Title");

// Update progress
lv_subject_set_int(&my_app_value, 75);

// Get current value
int current = lv_subject_get_int(&my_app_state);
```

***For a full example check out the Music Control App (app/src/applications/music_control)***

## Resources

- [LVGL Documentation](https://docs.lvgl.io/)
- [LVGL Editor Documentation](https://docs.lvgl.io/master/details/xml/index.html)
- [LVGL Editor Examples](https://github.com/lvgl/lvgl_editor/tree/master/tutorials)
- Component examples: See `components/music_app/`
