/*
 * Copyright (c) 2025 ZSWatch Project
 * SPDX-License-Identifier: Apache-2.0
 *
 * DA7212 Audio Codec Test overlay for WatchDK
 *
 * Wiring (WatchDK → DA7212 EVB):
 *   I2S header (X502):
 *     Pin 1: +1V8       → EVB VDD_IO / VDDA
 *     Pin 2: MCLK P1.07 → EVB MCLK
 *     Pin 3: WS   P1.09 → EVB WCLK (LRCK)
 *     Pin 4: Data P1.10 → EVB SDIN (nRF TX → codec RX)
 *     Pin 6: GND        → EVB GND
 *   GPIO header (X605):
 *     Pin 4: P1.14      → EVB BCLK (SCK)
 *   I2C (dedicated i2c3 instance):
 *     SDA P0.22  → EVB SDA
 *     SCL P0.05  → EVB SCL
 */

&pinctrl {
    i2s0_default: i2s0_default {
        group1 {
            psels = <NRF_PSEL(I2S_MCK, 1, 7)>,
                    <NRF_PSEL(I2S_SCK_M, 1, 14)>,
                    <NRF_PSEL(I2S_LRCK_M, 1, 9)>,
                    <NRF_PSEL(I2S_SDOUT, 1, 10)>;
        };
    };

    i2s0_sleep: i2s0_sleep {
        group1 {
            psels = <NRF_PSEL(I2S_MCK, 1, 7)>,
                    <NRF_PSEL(I2S_SCK_M, 1, 14)>,
                    <NRF_PSEL(I2S_LRCK_M, 1, 9)>,
                    <NRF_PSEL(I2S_SDOUT, 1, 10)>;
            low-power-enable;
        };
    };

    i2c3_default: i2c3_default {
        group1 {
            psels = <NRF_PSEL(TWIM_SDA, 0, 22)>,
                    <NRF_PSEL(TWIM_SCL, 0, 5)>;
        };
    };

    i2c3_sleep: i2c3_sleep {
        group1 {
            psels = <NRF_PSEL(TWIM_SDA, 0, 22)>,
                    <NRF_PSEL(TWIM_SCL, 0, 5)>;
            low-power-enable;
        };
    };
};

/ {
    codec_mclk: codec-mclk {
        compatible = "fixed-clock";
        #clock-cells = <0>;
        clock-frequency = <4096000>;
    };

    aliases {
        i2s-codec-tx = &i2s0;
    };
};

&clock {
    hfclkaudio-frequency = <12288000>;
};

&i2s0 {
    status = "okay";
    pinctrl-0 = <&i2s0_default>;
    pinctrl-1 = <&i2s0_sleep>;
    pinctrl-names = "default", "sleep";
    clock-source = "ACLK";
};

&i2c3 {
    compatible = "nordic,nrf-twim";
    status = "okay";
    clock-frequency = <I2C_BITRATE_FAST>;
    pinctrl-0 = <&i2c3_default>;
    pinctrl-1 = <&i2c3_sleep>;
    pinctrl-names = "default", "sleep";

    audio_codec: da7212@1a {
        compatible = "dlg,da7212";
        reg = <0x1a>;
        clock-source = "MCLK";
        clocks = <&codec_mclk>;
        clock-names = "mclk";
    };
};
